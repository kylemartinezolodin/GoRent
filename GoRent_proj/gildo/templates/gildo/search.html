<!DOCTYPE html>
{%load static%}
<html lang="en">
<head>
<style>
    .container-nearby_list{
        background-color: lightblue;
        font-size: 16px;
        font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
    }
    .myDiv  {
        background-color: lightblue;
        font-size: 16px;
        font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
    }
    .button {
        background-color: #4CAF50; /* Green */
        border: none;
        color: white;
        padding: 12px 24px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        margin: 2px 1px;
        transition-duration: 0.4s;
        cursor: pointer;
    }
    .button1 {
        background-color: #008CBA;
        color: black; 
        border: 2px solid #008CBA;
        border-radius: 8px;
    }
    .button1:hover {
        background-color: white;
        color: white;
    }   
</style>
    <link rel = "icon" href = "{% static 'gildo/img/gorent_icon.png' %}" type = "image/png"> 
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="stylesheet" href="{% static 'https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css' %}"> -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> -->

    <meta charset="utf-8">

    <title>GoRent | Search</title>
    

    <!-- load stylesheets -->
    <link rel="stylesheet" href="{% static 'gildo/https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700' %}">  <!-- Google web font "Open Sans" -->
    <link rel="stylesheet" href="{% static 'gildo/font-awesome-4.7.0/css/font-awesome.min.css' %}">                <!-- Font Awesome -->
    <link rel="stylesheet" href="{% static 'gildo/css/bootstrap.min.css' %}">                                      <!-- Bootstrap style -->
    <link rel="stylesheet" type="text/css" href="{% static 'gildo/slick/slick.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'gildo/slick/slick-theme.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'gildo/css/datepicker.css' %}"/>
    <link rel="stylesheet" href="{% static 'gildo/css/tooplate-style.css' %}">                                   <!-- Templatemo style -->
    <link rel="stylesheet" href="{% static 'search/css/page_styles.css' %}">  <!-- MAIN PAGE TOPNAV AND MAP  STYLES -->
    <link rel="stylesheet" href="{% static 'search/css/sidepanel_left.css' %}">  <!-- MAIN PAGE ADD SPACE STYLES -->
    <link rel="stylesheet" href="{% static 'search/css/sidepanel_right.css' %}">  <!-- MAIN PAGE NEARBY LISTING STYLES -->
    <link rel="stylesheet" href="{% static 'search/css/map_styles.css' %}">  <!-- MAIN PAGE MAP STYLES -->


    <!-- LEAFLET CSS (AND JS IT IS REQUIRED THAT JS SHOULD BE PUT AFTER THE CSS)-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" 
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/> <!-- BASE LEAFLET STYLES -->
        <link rel="stylesheet" href="{% static 'js/leaflet/geosearch.js' %}">  <!-- LEAFLET COORDINATES STYLES -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch@3.0.0/dist/geosearch.css"/> <!-- LEAFLET GEOSEARCH STYLES -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin="">
    </script>
    
    <!-- BASE LEAFLET JS -->
    <script src="https://unpkg.com/leaflet-geosearch@3.0.0/dist/geosearch.umd.js"></script> <!-- LEAFLET ADD-ON GEOSEARCH JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" /> <!-- LEAFLET ADD-ON leaflet-control-geocoder STYLES -->
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script> <!-- LEAFLET ADD-ON leaflet-control-geocoder JS -->
    <script src="{% static 'js/leaflet/geosearch.js' %}"></script> <!-- LEAFLET ADD-ON leaflet-geoip JS -->
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
          <![endif]-->
</head>

    <body>
        <div class="tm-main-content" id="top">
            
            <!-- CUSTOM TOP NAVBAR  NI OLODIN--> 
            <!-- <div class="gorent-top-navbar"> -->
                <!-- <div class="top-navbar-left_group"> -->
                    <!-- <div class="container-logo">
                        <img src="{% static 'img/gorent_icon.png' %}" alt="Site logo">
                        <img src="{% static 'img/gorent_plain.png' %}" alt="Site logo">
                    </div> -->
                <!-- </div> -->

                <!-- <div class="container-topnav_buttons">
                    <a class="topnav_button" href="#">About Us</a>
                    <a class="topnav_button" href="#">Register your space</a>
                </div> -->
                
            <!-- </div> -->

            <!-- <div class="tm-top-bar-bg"></div>
            <div class="tm-top-bar" id="tm-top-bar"> -->
                
        <!-- Top Navbar -->
        <div class="container">
            <div class="row">   
                <nav class="navbar navbar-expand-lg narbar-light">
                    <a class="navbar-brand mr-auto" href="#">
                        <img src="{% static 'img/gorent_icon.png' %}" alt="Site logo">
                        <img src="{% static 'img/gorent_plain.png' %}" alt="Site logo">
                    </a>
                    <button type="button" id="nav-toggle" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#mainNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div id="mainNav" class="collapse navbar-collapse tm-bg-white">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="#top">About Us <span class="sr-only">(current)</span></a>
                            </li>

                            {% if user is None %} <!-- IF "user" EXIST IN CONTEXT -->
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'registers:about_view' %}">Register your space</a>
                            </li>
                            {% else %}
                            <li class="nav-item">
                                <a class="nav-link" href="settings.html">{{user.fistname}}{{user.lastname}}</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'registers:logout_view' %}">logout</a>
                            </li>
                            {% endif %}
                            <!-- <li class="nav-item">
                                <a class="nav-link active" href="#tm-section-5">Rent</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="Billing.html">Billings</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#tm-section-6" >My Account</a>
                            </li> -->
                        </ul>
                    </div>                            
                </nav>            
            </div> 

            </div>
        </div>



            <!-- MAIN CONTENT CONTAINER -->
            <div style="display: flex;">
                <!-- MAP -->
                <div id="map" class="map_viewport" style="position: relative; height: 95vh; outline: none;">

                    <!-- MAP SEARCH BAR -->
                    <!-- <div class="container-map_searchbar">
                        <input type="text" name="" id="" class="map_seachbar">
                        
                        <div class="map_search_results">
                            Spain, Skimberlo 6000
                        </div>
                    </div>
                    -->
                
                    <!-- MAP JS -->
                    <script type="text/javascript">
                        recentlyClickedSpaceId = -1;
                        // ADD MARKER SAMPLE CODE
                        markers = [
                            {% for space in spaces %}
                            L.marker([{{space.coordinates}}],{
                                title: '{{space.id}}',
                            }).on('click', doSomething),
                            {% endfor %}

                            // L.marker([10.30, 123.700]),
                        ]
                        
                        function doSomething(e){
                            console.log("tambis")
                            recentlyClickedSpaceId = e.target.options["title"]
                            console.log(e.target.options["title"])

                            var contentContainer = document.createElement("div");
                            $.ajax({
                                    url: "{% url 'gildo:main_view' %}",
                                    type: "post",
                                    headers: {
                                    'X-CSRFToken':'{{csrf_token}}',
                                    },
                                    data: JSON.stringify({"ajaxAction": "getSpaceInformation", "spaceId": recentlyClickedSpaceId}),
                                    
                                success: function (response) {
                                    console.log('funky')
                                    console.log(response)// You will get response from your PHP page (what you echo or print)
                                    //console.log(response[0])
                                    console.log(response["space"])
                                    
                                    // contentContainer.className = "container-nearby_list_items"
                                    
                                    spaceName = document.createElement("div")
                                    spaceName.innerHTML = "<b>"+response["space"]["name"]+"</b>"
                                    contentContainer.appendChild(spaceName)
                                    
                                    ownerEmailContainer = document.createElement("div")
                                    ownerEmailContainer.innerHTML = "Contact: " +response["space"]["owner"] +" | " +response["space"]["contactNumber"]
                                    contentContainer.appendChild(ownerEmailContainer)

                                    ownerNumberContainer = document.createElement("div")
                                    ownerNumberContainer.innerHTML = "Address: " +response["space"]["address"]
                                    contentContainer.appendChild(ownerNumberContainer)

                                    spacePriceContainer = document.createElement("div")
                                    spacePriceContainer.innerHTML = "Monthly: Php" +response["space"]["price"]
                                    contentContainer.appendChild(spacePriceContainer)
                                    
                                  
                                },
                                    error: function(jqXHR, textStatus, errorThrown) {
                                    console.log(textStatus, errorThrown);
                                    contentContainer.innerHTML = "<center>Something went wrong. Please try again.</center>"
                                    }
                                });


                            L.popup({"minWidth": 250})
                            .setLatLng(e.latlng)
                            .setContent(contentContainer)
                            .openOn(map);

                        }

                        user_flag = {% if user is None %} false {% else %} true {% endif %};
                        user_locate = {
                            isLocating: false, // BECOMES TRUE IF USER IS MANUALLY LOCATING 
                            location: null,
                            // locationListener: function (val) { // A MAKESHIFT LISTENER WHEN address PROPERTY IS CHANGED
                            //     if (user_flag)
                            //         fillSpaceInfo() // USED WHEN LOGGED IN
                            //     else
                            //         activateNearbyList() // USED WHEN RENTEE
                            // },
                            set location(val) { // OVERIDING SETTER (I.E. user_locate.address = [some_value] EVENT)
                                // this._location = val // THE UNDERSCORE/"_" AFTER THE address IS VERY VITAL TO AVOID RECURSSION
                                console.log("nimal")
                                parentObject = this
                                $.when( $.ajax({
                                    url: "{% url 'gildo:main_view' %}",
                                    type: "post",
                                    async: false,
                                    headers: {
                                    'X-CSRFToken':'{{csrf_token}}',
                                    },
                                    data: JSON.stringify({"ajaxAction": "coordinatesValidation", "coordsInput": val.lat+","+val.lng}),
                                    success: function (response) {
                                    if (response["isValid"]){
                                        console.log("Coordinates valid");
                                    }
                                    else{
                                        console.log("Invalid Coordinates");
                                    }
                                    console.log(val);
                                    },
                                    error: function(jqXHR, textStatus, errorThrown) {
                                        console.log("Something went wrong", textStatus, errorThrown);
                                    }
                                })).then(function( response, textStatus, jqXHR ) {
                                        console.log("wew",response)
                                        if (response["isValid"])
                                            parentObject._location = val // THE UNDERSCORE/"_" AFTER THE address IS VERY VITAL TO AVOID RECURSSION
                                        else
                                            alert("Invalid Coordinates")
                                });
                                // if (checkCoordsAjax(val)){
                                //     this._location = val // THE UNDERSCORE/"_" AFTER THE address IS VERY VITAL TO AVOID RECURSSION
                                // }
                            },
                            get location() { // OVERIDING GETTER (I.E. console.log(user_locate.address) EVENT)
                                return this._location // THE UNDERSCORE/"_" AFTER THE address IS VERY VITAL TO AVOID RECURSSION
                            },

                            address: null, // L.Control.Geocoder FROM: https://github.com/perliedman/leaflet-control-geocoder/tree/1.13.0#lcontrolgeocoder IS ASYCNHRONOUS THUS WHY WE NEED TO UPDATE AFTER user_locate.address IS UPDATED
                            addressListener: function (val) { // A MAKESHIFT LISTENER WHEN address PROPERTY IS CHANGED
                                if (user_flag)
                                    fillSpaceInfo() // USED WHEN LOGGED IN
                                else
                                    activateNearbyList() // USED WHEN RENTEE
                            },
                            set address(val) { // OVERIDING SETTER (I.E. user_locate.address = [some_value] EVENT)
                                console.log("qwenimal")
                                // this._address = val // THE UNDERSCORE/"_" AFTER THE address IS VERY VITAL TO AVOID RECURSSION
                                // this.addressListener(val);
                                parentObject = this
                                $.when( $.ajax({
                                    url: "{% url 'gildo:main_view' %}",
                                    type: "post",
                                    async: false,
                                    headers: {
                                    'X-CSRFToken':'{{csrf_token}}',
                                    },
                                    data: JSON.stringify({"ajaxAction": "addressValidation", "addressInput": val}),
                                    success: function (response) {
                                    if (response["isValid"]){
                                        console.log("Address valid");
                                        console.log(val);
                                    }
                                    else{
                                        console.log("Invalid Address");
                                        console.log(val);}
                                    },
                                    error: function(jqXHR, textStatus, errorThrown) {
                                        console.log("Something went wrong", textStatus, errorThrown);
                                    }
                                })).then(function( response, textStatus, jqXHR ) {
                                        console.log("wew",response)
                                        if (response["isValid"]){
                                            parentObject._address = val // then returnUNDERSCORE/"_" AFTER THE address IS VERY VITAL TO AVOID RECURSSION
                                            parentObject.addressListener(val);
                                        }
                                        else
                                            alert("Please pick within Central Visayas")
                                });
                                // if (checkAddressAjax(val)){
                                //     this._address = val // THE UNDERSCORE/"_" AFTER THE address IS VERY VITAL TO AVOID RECURSSION
                                //     this.addressListener(val);
                                // }

                            },
                            get address() { // OVERIDING GETTER (I.E. console.log(user_locate.address) EVENT)
                                return this._address // THE UNDERSCORE/"_" AFTER THE address IS VERY VITAL TO AVOID RECURSSION
                            },
                        }
                        
                        // A MAKESHIFT SLEEP() FROM: https://www.sitepoint.com/delay-sleep-pause-wait/
                        function sleep(ms) {
                            return new Promise(resolve => setTimeout(resolve, ms));
                        }
                        
                        async function toggleMapLocate () { // IT IS ASYNCH BECUASE IT USES THE MAKESHIFT SLEEP() FROM: https://www.sitepoint.com/delay-sleep-pause-wait/
                            await sleep(100)
                            // setTimeout(function() {
                            //     user_locate.isLocating = !user_locate.isLocating // locate IS A BOOLEAN
                            // }, 100);
                            user_locate.isLocating = !user_locate.isLocating
                            console.log("isLocating:" +user_locate.isLocating)
                        }

                        function getLocation() {
                            if (navigator.geolocation) { // CHECKS IF GEOLOCATION IS SUPPORTED IN THE BROWSER
                                navigator.geolocation.getCurrentPosition(showLocation); // getCurrentPosition() sends coordinates values to the function showLocation()
                            } else {
                                document.querySelector("#location").innerHTML = "Geolocation is not supported by this browser. Manully pick location instead";
                                document.querySelector("#button-auto_locate").style.display = "none"
                            }
                        }

                        function activateNearbyList () { // HAPPENS IF user_locate.location IS NO LONGER NULL
                            document.querySelector("#location").innerHTML = "Current Coordinates: " +"[lat:" +user_locate.location.lat +", lng: " +user_locate.location.lng +"] "
                            console.log("qweqwe")
                            // console.log({{csrf_token}})
                                $.ajax({
                                    url: "{% url 'gildo:main_view' %}",
                                    type: "post",
                                    headers: {
                                    'X-CSRFToken':'{{csrf_token}}',
                                    
                                    },
                                    data: JSON.stringify({"ajaxAction": "getNearbySpaces", "latitude": user_locate.location.lat, "longitude": user_locate.location.lng}),
                                    
                                success: function (response) {
                                    console.log('asd123')
                                    console.log(response)// You will get response from your PHP page (what you echo or print)
                                    //console.log(response[0])
                                    console.log(response["nearby_spaces"][0]["distance"])
                                    nearby_spaces = response["nearby_spaces"]
                                    
                                    document.getElementById("container-nearby_list").innerHTML = ''; // PLZ CHANGE THIS, It Removes all Space entries appended in previous querries

                                    for (let i = 0; i < nearby_spaces.length; i++) {
                                    console.log("mehh" +i);
                                    console.log(nearby_spaces[i]["space"]);
                                    var temp = document.createElement("div");
                                    temp.className = "container-nearby_list_items"
                                    
                                    temp2 = document.createElement("div")
                                    temp2.innerHTML = "Name: " + nearby_spaces[i]["space"]["name"]
                                    temp.appendChild(temp2)

                                    temp3 = document.createElement("div")
                                    temp3.innerHTML = "Contact Info: " + nearby_spaces[i]["space"]["owner"]["contactnumber"]
                                    temp.appendChild(temp3)

                                    temp4 = document.createElement("div")
                                    temp4.innerHTML = "Price: " + nearby_spaces[i]["space"]["price"]
                                    temp.appendChild(temp4)

                                    temp5 = document.createElement("div")
                                    temp5.innerHTML = nearby_spaces[i]["space"]["space"]
                                    temp.appendChild(temp5)

                                    tempbutton = document.createElement("button")
                                    tempbutton.setAttribute('data-toggle', "modal")
                                    tempbutton.setAttribute('data-target', "#exampleModal")
                                    tempbutton.setAttribute('onclick', "setModalReciepient('" +nearby_spaces[i]["space"]["owner"]["email"]  +"')") // Clicking the button call this function                                    
                                    // tempbutton.setAttribute('onclick', "dali(" +"'pop'"  +")") // Clicking the button call this function
                                    tempbutton.innerHTML = "Send Application"
                                    temp.appendChild(tempbutton)
                                    
                                    // tempButton = document.createElement("button")
                                    // input[type="button"].tempButton{}
                                    // temp.appendChild(tempButton)
                                    
                                    document.getElementById("container-nearby_list").appendChild(temp);
                                    
                                    reduceNearbySpaces()
                                    }
                                    
                                  
                                },
                                    error: function(jqXHR, textStatus, errorThrown) {
                                    console.log(textStatus, errorThrown);
                                    }
                                });

                            document.querySelector("#button-manual_locate").innerHTML = "Pick Another Location"
                            document.querySelector("#button-auto_locate").style.display = "none"
                            document.querySelector("#container-nearby_list").style.display = "block"
                        }

                        function reduceNearbySpaces() {
                            console.log("awoooooooooooooooooooooooooooooooo")
                            nearbySpaceElement = document.querySelector("#container-nearby_list")
                            nearbySpaceList = nearbySpaceElement.children

                                console.log(nearbySpaceList.length)
                            for (let i = 0; i < nearbySpaceList.length; i++) {
                                space = nearbySpaceList[i];
                                
                                spaceHaveMarker = false
                                for (let j = 0; j < markers.length; j++) {
                                    marker = markers[j];
                                    
                                    console.log(marker.options["title"], "nimal")
                                    
                                    console.log(space.children[3].innerHTML, "nimal2")
                                    if(space.children[3].innerHTML === marker.options["title"]){
                                        spaceHaveMarker = true
                                        break;
                                    }
                                }
                                
                                if (!spaceHaveMarker)
                                    nearbySpaceElement.removeChild(nearbySpaceElement.children[i])
                            }
                        }

                        function dali(ez) {
                            console.log("kapoy" +ez);
                        }
                        function setModalReciepient(email) {
                            document.querySelector("#send_application-modal-owner").value = email
                        }

                    
                        
                        function fillSpaceInfo () { // HAPPENS IF user_locate.location IS NO LONGER NULL
                            document.querySelector("#location").innerHTML = "ANG ADDRESS KAY: " +user_locate.address +" NYA COORDINATES KAY: " +"[lat:" +user_locate.location.lat +", lng: " +user_locate.location.lng +"] GAMITA NI PARA MAKA ADD OG SPACE"

                            document.querySelector("#button-manual_locate").innerHTML = "Pick Another Location"
                            document.querySelector("#button-auto_locate").style.display = "none"
                            document.querySelector("#button-submit_space").style.display = "block"
                            document.querySelector("#button-add_space_image").style.display = "block"
                        }

                        function toggleLoadingScreen () { // WALA PA GI GAMIT KAY MURAG MO CAUSE OG PROBLEM, ANYWAY AESTHETICS RAMNSAD NI NGA FUNCTIONALITIES
                            loading_screen = document.querySelector("#container-nearby_list_loading_screen")
                            if (loading_screen.style.display == "none") {
                                loading_screen.style.display = "block"
                                document.querySelector("#container-nearby_list").style.display = "none"
                            }
                            else {
                                loading_screen.style.display = "none"
                                document.querySelector("#container-nearby_list").style.display = "block"
                            }
                        }

                        function checkAddressAjax(input) {
                            flag = false
                            $.ajax({
                                    url: "{% url 'gildo:main_view' %}",
                                    type: "post",
                                    async: false,
                                    headers: {
                                    'X-CSRFToken':'{{csrf_token}}',
                                    },
                                    data: JSON.stringify({"ajaxAction": "addressValidation", "addressInput": input}),
                                    success: function (response) {
                                    if (response["isValid"]){
                                        console.log("Address valid");
                                        console.log(input);
                                        return true
                                    }
                                    else{
                                        console.log("Invalid Address");
                                        console.log(input);}
                                        return false
                                    },
                                    error: function(jqXHR, textStatus, errorThrown) {
                                        console.log("Something went wrong", textStatus, errorThrown);
                                        return false
                                    }
                                });
                            // return flag
                        }

                        
                        function checkCoordsAjax(input) {
                            flag = false
                            $.ajax({
                                url: "{% url 'gildo:main_view' %}",
                                type: "post",
                                async: false,
                                headers: {
                                'X-CSRFToken':'{{csrf_token}}',
                                },
                                data: JSON.stringify({"ajaxAction": "coordinatesValidation", "coordsInput": input.lat+","+input.lng}),
                                success: function (response) {
                                if (response["isValid"]){
                                    console.log("Coordinates valid");
                                    return true
                                }
                                else{
                                    console.log("Invalid Coordinates");
                                    console.log(input);
                                    return false
                                }
                                },
                                error: function(jqXHR, textStatus, errorThrown) {
                                    console.log("Something went wrong", textStatus, errorThrown);
                                    return false
                                }
                            });
                            // return flag
                        }

                    </script>
                </div>

                                
                {% if user is None %}

                <!-- NEARBY LIST BLOCK -->
                <div class="map-sidepanel-right">
                    
                    <button id="button-manual_locate" onclick="toggleMapLocate()" type="button" class="btn btn-secondary"   >Pick Location on Map</button>
                    <button id="button-auto_locate"  onclick="getLocation()" class="btn btn-outline-primary">Enable Location</button>

                    <form action="index.html" method="get" class="">
                        {% csrf_token %}
                        <input name="price" type="text" class="" id="inputLocation" placeholder="Budget (PHP)">
                    </form>

                    Nearby spaces:
                    <br>
                    <div id="location"></div>
                    <div id="container-nearby_list_loading_screen" class="container-nearby_list_loading_screen" style="display: none;">
                        LOADING
                    </div>
                    <div id="container-nearby_list" class="container-nearby_list" style="display: none;">
                        <div class="container-nearby_list_items">
                            <div>
                                Crown Regency
                            </div>
                            <div>
                            Fuente 12356 Kalsada St., Cebu City
                            </div>
                            <div>
                            [Some Image][Some Image][Some Image]
                            </div>
                            <button>Send Application</button>
                        </div>
                    </div>

                </div>

                <!-- Send Application Modal -->
                <!-- EGUIA ADA ANG MODAL APPLICATION -->
                <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="send_application-modal-owner">
                            Email:<input type="text" id="send_application-modal-email">
                        </div>
                        <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" onclick="submitApplicationModal()">Submit</button>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- MODAL SCRIPT -->
                <script type="text/javascript">
                    function submitApplicationModal() { // EGUIA ADA ANG AJAX APPLICATION
                        $.ajax({
                                url: "{% url 'gildo:main_view' %}",
                                type: "post",
                                headers: {
                                'X-CSRFToken':'{{csrf_token}}',
                                
                                },
                                data: JSON.stringify({
                                "ajaxAction": "renteeApplicationSubmition",
                                "owner": document.querySelector("#send_application-modal-owner").value,
                                "email": document.querySelector("#send_application-modal-email").value
                                }),
                                success: function (response) {
                                    console.log("Space Application Sent!")
                                },
                                error: function(jqXHR, textStatus, errorThrown) {
                                console.log(textStatus, errorThrown);
                                }
                            });

                    }
                </script>

                {% else %}
                
                    {% if type == "RentOwner"  or type == "Sharee"%}

                    <div class="map-sidepanel-left">
                        <h4><center>Register Space</center></h4>
                        
                        <button class="btn btn-sub" id="button-manual_locate" onclick="toggleMapLocate()">Pick Location on Map</button>
                        <button class="btn btn-sub" id="button-auto_locate"  onclick="getLocation()">Enable Location</button>
                        <div id="location"></div>
                        
                        <br>
                        <div class="subtext" id="address"></div>
                        <div class="subtext" id="longitude"></div>
                        <div class="subtext" id="latitude"></div>
                        <br>
    
                        <input name="price" type="number" class="form-control" id="price" placeholder="Price" style="height: 8%;">
                        <br>
                        Upload images<input type="file" class="btn btn-sub" id="spaceImage" name="spaceImage" accept="image/png, image/jpeg" placeholder="Upload image">
                            <br>
                            <button type="button" class="btn btn-sub" id="addRoommates">Add Roommates</button>
                            <button type="button" class="btn btn-sub" id="button-upload_space_image">Upload Image</button>
    
                        <div id="space_roommates">
                        </div>
    
    
                        <button id="button-submit_space" class="btn btn-primary tm-btn-search" onclick="submitSpace()">Submit</button>
    
                        
                    </div>
                    
                    <!-- REGISTER SPACE SCRIPT -->
                    <script>
                        function asd() {
                            console.log(amw)
                        }
                        function submitSpace(){
                            console.log("asd")
                            coords  = document.querySelector("#latitude").innerHTML +"," +document.querySelector("#longitude").innerHTML
                            address = document.querySelector("#address").innerHTML
                            price = document.querySelector("#price").value
                            Roommates = []
    
                            // a = document.querySelector("#space_roommates").childNodes
                            // b = a[1].querySelectorAll("span")
                            
                            roommate_entries = document.querySelector("#space_roommates").childNodes
    
                            for (let index = 1; index < roommate_entries.length; index++) {
                                input_value = roommate_entries[index].querySelectorAll("span")
                                Roommates.push([input_value[0].innerHTML, input_value[1].innerHTML, input_value[2].innerHTML]) // input_value[0] is FirstName, input_value[1] is FamilyName, input_value[2] is ContactNumber
                            }
    
                            console.log(Roommates)
    
                            $.ajax({
                                url: "{% url 'gildo:main_view' %}",
                                type: "post",
                                headers: {
                                    'X-CSRFToken':'{{csrf_token}}',
                                },
                                data: JSON.stringify({
                                    "ajaxAction": "SpaceRegister",
                                    "firstname": "{{user.fistname}}",
                                    "lastname": "{{user.lastname}}",
                                    "Coordinates": coords,
                                    "Address":address,
                                    "Price":price,
                                    "Roommates": Roommates
                                }),
                                success: function (response) {
                                    alert("Space Submitted")
                                },
                                error: function(jqXHR, textStatus, errorThrown) {
                                    alert("Registration Failed", errorThrown);
                                }
                            });
                        }
    
                        $(document).ready(function(){
                        $("#addRoommates").click(function(){
                            $("#myModal").modal();
                        });
                        });
                        
                        function addRoommates(){
                            firstname  = document.querySelector("#firstname").value
                            lastname = document.querySelector("#lastname").value
                            contactnumber = document.querySelector("#contactnumber").value
                            // $.ajax({
                            //     url: "{% url 'gildo:main_view' %}",
                            //     type: "post",
                            //     headers: {
                            //         'X-CSRFToken':'{{csrf_token}}',
                            //     },
                            //     data: JSON.stringify({
                            //         "ajaxAction": "AddRoommate",
                            //         "firstname": firstname,
                            //         "lastname": lastname,
                            //         "contactnumber": contactnumber,
                            //     }),
                            //     success: function (response) {
                            //         alert("Roommate Added")
                            //     },
                            //     error: function(jqXHR, textStatus, errorThrown) {
                            //         alert("Registration Failed", errorThrown);
                            //     }
                            // });
    
                            // roomate_firstname_container = document.createElement("p").innerHTML = firstname;
                            // roomate_lastname_container = document.createElement("p") = lastname;
                            // roomate_contactnumber_container = document.createElement("p") = contactnumber;
    
                            
                            space_roomate_container = document.createElement("div");
                            space_roomate_container.innerHTML = "<span>" +firstname +"</span> <span>" +lastname +"</span> (<span>"+contactnumber +"</span>)"
    
                            // space_roomate_container.innerHTML = "<div><p>""</p></div>"
    
                            // space_roomate_container.appendChild(roomate_firstname_container)
                            // space_roomate_container.appendChild(roomate_lastname_container)
                            // space_roomate_container.appendChild(roomate_contactnumber_container)
    
                            
    
                            document.querySelector("#space_roommates").appendChild(space_roomate_container)
                        }
    
                        
    
                        
                    </script>
                    
                    
                    {% endif %}
                
                <!-- REQUEST LIST BLOCK FOR RENTOWNER -->
                {% for item in rentowner %}
                <div class="map-sidepanel-right">
                    Request List:
                    <br>
                    <div id="container-request_list" class="container-request_list">
                        <div class="bg-light">
                            <div class="bg-light">
                                <p>Firstname: {{item.firstname}} </p>
                                <p>Lastname: {{item.lastname}} </p>
                                <p>Email: {{item.email}} </p>
                                <p>Contact: {{item.contactnumber}} </p>
                            </div>
                            <button name="email-id" value={{email.id}} type="submit" id="btnAccept" class="btn btn-primary">Accept</button>
                            <button name="email-id" value={{email.id}} type="submit" id="btnDelete" class="btn btn-primary">Decline</button>
                            <br>
                        </div>
                    </div>
                </div>
                {% endfor%}

                <!-- REQUEST LIST BLOCK FOR SHAREE -->
                
                <div class="map-sidepanel-right">
                    <div class="myDiv"> <h4>Request List:</h4></div>
                    {% for item in sharee %}
                    <form id = "form1" action="" method="POST" autocomplete="off" enctype="multipart/form-data">
                    {% csrf_token %}
                        <div class="myDiv">
                                <div>First Name: {{item.firstname}} </div>
                                <div>Last Name: {{item.lastname}} </div>
                                <div>Email: {{item.email}} </div>
                                <div>Contact Number: {{item.contactnumber}} </div>
                         <div id="container-request_list" class="container-request_list">
                                <input type="text" name="email-id" value = {{item.email}} hidden>
                                <center>
                                <button class="button button1" name="btnAccept" type="submit" id="btnAccept" class="btn btn-primary">Accept</button>
                                <button class="button button1" name="btnDelete" type="submit" id="btnDelete" class="btn btn-primary">Delete</button>
                                </center>
                        </div>
                        </div>
                    </form>
                    <br>
                    {% endfor %}
                </div>

                {% endif %}
                
            </div>
            <!-- END MAIN CONTENT CONTAINER -->

            <!-- GILDO'S BODY CURRENTLY HIDDEN -->
            <div class="tm-section tm-bg-img" id="tm-section-1" style="display: none">
                <div class="tm-bg-green ie-container-width-fix-2">
                    <div class="container ie-h-align-center-fix">
                        <div class="row">
                            <div class="col-xs-12 ml-auto mr-auto ie-container-width-fix">
                                <form action="index.html" method="get" class="tm-search-form tm-section-pad-2">
                                    {% csrf_token %}
                                    <div class="form-row tm-search-form-row">
                                        <div class="form-group tm-form-element tm-form-element-2">
                                            <i class="fa fa-map-marker fa-2x tm-form-element-icon"></i>
                                            <input name="location" type="text" class="form-control" id="inputLocation" placeholder="Location...">
                                        </div>
                                        <div class="form-group tm-form-element tm-form-element-2">                                            
                                            <select name="adult" class="form-control tm-select" id="adult">
                                                <option value="">Housing Type</option>
                                                <option value="1">Boarding House</option>
                                                <option value="2">Apartment</option>
                                                <option value="3">Dormitory</option>
                                                <option value="4">Semi-Owned House</option>
                                            </select>
                                            <i class="fa fa-2x fa-home tm-form-element-icon"></i>
                                        </div>
<!--                                         
                                    </div>
                                    <div class="form-row tm-search-form-row"> -->
                                        <div class="form-group tm-form-element tm-form-element-2">                                            
                                            <select name="children" class="form-control tm-select" id="children">
                                                <option value="">Budget (Php)</option>
                                                <option value="0">Any</option>
                                                <option value="1">Below 500</option>
                                                <option value="2">1,000 to 3,000</option>
                                                <option value="3">3,000 to 5,000</option>
                                                <option value="4">5,000 to 7,000</option>
                                                <option value="5">Above 7,000</option>
                                            </select>
                                            <i class="fa fa-money tm-form-element-icon tm-form-element-icon-small"></i>
                                        </div>
                                        <div class="form-group tm-form-element tm-form-element-2">
                                            <select name="room" class="form-control tm-select" id="room">
                                                <option value="">Single Space</option>
                                                <option value="1">2-person</option>
                                                <option value="1">3-person</option>
                                                <option value="1">4-person</option>
                                            </select>
                                            <i class="fa fa-2x fa-bed tm-form-element-icon"></i>
                                        </div>
                                        
                                      </div>
                                      
                                      <!-- <div class="form-row clearfix pl-2 pr-2 tm-fx-col-xs">
                                          
                                          
                                          <div class="form-group tm-form-element tm-form-element-2">
                                            
                                            <a href="#" class="ie-10-ml-auto ml-auto mt-1 tm-font-semibold tm-color-primary">Need Help?</a> 
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary tm-btn-search">GoRent</button>
                                        
                                      </div> -->
                                      <!-- Content Map -->
                                      
                                      <div class="left-column">
                                        <div class="column-content">
                                            
                                                <div id="map1"></div>        
                                                
                                        </div>

                                      </div>
                                    
                                    <div class="column-space">
                                        <p></p>
                                    </div>
                                    <div class="right-column">
                                        <div class="column-content">
                                            <h6>Rentee Rating: * * * * *</h6>
                                            <br>Late Payment: [0]
                                            <br>Advance Payment: [4]
                                        </div>
                                    </div>
                                    <div class="column-space">
                                        <p></p>
                                    </div>
                                    <div class="right-column">
                                        <div class="column-content">
                                            <h6>Rentee Rating: * * * * *</h6>
                                            <br>Late Payment: [0]
                                            <br>Advance Payment: [4]
                                        </div>
                                    </div>
                                    <div class="column-space">
                                        <p></p>
                                    </div>
                                    <div class="right-column">
                                        <div class="column-content">
                                            <h6>Rentee Rating: * * * * *</h6>
                                            <br>Late Payment: [0]
                                            <br>Advance Payment: [4]
                                        </div>
                                    </div>
                                    
                                    <input  type="submit" class="button special Search-btn" value="submit">
                                </form>
                                
                            </div>                        
                        </div>      
                    </div>
                </div>                  
            </div>
            
            <!-- <div class="tm-section tm-section-pad tm-bg-img tm-position-relative" id="tm-section-6">
                <div class="container ie-h-align-center-fix">
                    <div class="row">
                        
                        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-5 mt-3 mt-md-0">
                            <div class="tm-bg-white tm-p-4">
                                <form action="index.html" method="post" class="contact-form">
                                    <div class="form-group">
                                        <input type="text" id="contact_name" name="contact_name" class="form-control" placeholder="Name"  required/>
                                    </div>
                                    <div class="form-group">
                                        <input type="email" id="contact_email" name="contact_email" class="form-control" placeholder="Email"  required/>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="contact_subject" name="contact_subject" class="form-control" placeholder="Subject"  required/>
                                    </div>
                                    <div class="form-group">
                                        <textarea id="contact_message" name="contact_message" class="form-control" rows="9" placeholder="Message" required></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary tm-btn-primary">Send Message Now</button>
                                </form>
                            </div>                            
                        </div>
                    </div>        
                </div>
            </div> -->


            <!-- GILDO'S FOOTER CURRENTLY HIDDEN -->
            <footer class="tm-bg-primary" style="display: none">
                <div class="container">
                    <div class="row">
                        <p class="col-sm-12 text-center tm-font-light tm-color-white p-4 tm-margin-b-0">
                        Copyright &copy; <span class="tm-current-year">2021</span> PauerOf2
                        
                        <!-- - Design: <a rel="nofollow" href="https://www.tooplate.com" class="tm-color-primary tm-font-normal" target="_parent">Tooplate</a></p>         -->
                    </div>
                </div>                
            </footer>
        </div>
        
        <!-- load JS files -->
        <script src="{% static 'gildo/js/jquery-1.11.3.min.js' %}"></script>             <!-- jQuery (https://jquery.com/download/) -->
        <script src="{% static 'gildo/js/popper.min.js' %}"></script>                    <!-- https://popper.js.org/ -->       
        <script src="{% static 'gildo/js/bootstrap.min.js' %}"></script>                 <!-- https://getbootstrap.com/ -->
        <script src="{% static 'gildo/js/datepicker.min.js' %}"></script>                <!-- https://github.com/qodesmith/datepicker -->
        <script src="{% static 'gildo/js/jquery.singlePageNav.min.js' %}"></script>      <!-- Single Page Nav (https://github.com/ChrisWojcik/single-page-nav) -->
        <script src="{% static 'gildo/slick/slick.min.js' %}"></script>                  <!-- http://kenwheeler.github.io/slick/ -->
        <script src="{% static 'gildo/js/maps.js' %}"></script>

       <script>
            function setCarousel() {
                
                if ($('.tm-article-carousel').hasClass('slick-initialized')) {
                    $('.tm-article-carousel').slick('destroy');
                } 

                if($(window).width() < 438){
                    // Slick carousel
                    $('.tm-article-carousel').slick({
                        infinite: false,
                        dots: true,
                        slidesToShow: 1,
                        slidesToScroll: 1
                    });
                }
                else {
                 $('.tm-article-carousel').slick({
                        infinite: false,
                        dots: true,
                        slidesToShow: 2,
                        slidesToScroll: 1
                    });   
                }
            }

            function setPageNav(){
                if($(window).width() > 991) {
                    $('#tm-top-bar').singlePageNav({
                        currentClass:'active',
                        offset: 79
                    });   
                }
                else {
                    $('#tm-top-bar').singlePageNav({
                        currentClass:'active',
                        offset: 65
                    });   
                }
            }

            
           
            
       
            $(document).ready(function(){

                $(window).on("scroll", function() {
                    if($(window).scrollTop() > 100) {
                        $(".tm-top-bar").addClass("active");
                    } else {
                        //remove the background property so it comes transparent again (defined in your css)
                       $(".tm-top-bar").removeClass("active");
                    }
                });      

                

                // Date Picker
                const pickerCheckIn = datepicker('#inputCheckIn');
                const pickerCheckOut = datepicker('#inputCheckOut');
                
                // Slick carousel
                setCarousel();
                setPageNav();

                $(window).resize(function() {
                  setCarousel();
                  setPageNav();
                });

                // Close navbar after clicked
                $('.nav-link').click(function(){
                    $('#mainNav').removeClass('show');
                });

               

                // Update the current year in copyright
                $('.tm-current-year').text(new Date().getFullYear());                           
            });

        </script>             

</body>
</html>